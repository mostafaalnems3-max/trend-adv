<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Trend Adv</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main-color: #00bcd4; --dark-bg: #1a1a1a; }
        body { font-family: sans-serif; background-color: #f4f7f6; margin: 0; padding-bottom: 50px; }
        .dash-header { background: var(--dark-bg); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .add-ad-btn { background: var(--main-color); color: white; border: none; padding: 15px 30px; border-radius: 25px; display: block; margin: 20px auto; font-weight: bold; cursor: pointer; font-size: 16px; box-shadow: 0 4px 10px rgba(0,188,212,0.3); }
        .modal { display:none; position:fixed; top:0; right:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; padding-top:20px; overflow-y: auto; }
        .modal-content { background:white; width:90%; max-width:450px; margin:auto; padding:20px; border-radius:15px; color:#333; }
        input { width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:8px; box-sizing: border-box; }
        label { font-size: 13px; color: #666; display: block; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="dash-header">
        <a href="index.html" style="color:white; text-decoration:none; font-size:14px;"><i class="fas fa-arrow-right"></i> Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
        <span style="font-weight: bold;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Trend Adv</span>
    </div>

    <button class="add-ad-btn" onclick="document.getElementById('adModal').style.display='block'">â• Ø¥Ø¶Ø§ÙØ© Ù„ÙˆØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>

    <div id="adModal" class="modal">
        <div class="modal-content">
            <h3 style="text-align:center;">Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„ÙˆØ­Ø©</h3>
            <form id="google-form">
                <input type="text" name="siteName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆÙƒØ§Ù„Ø© / Ø§Ù„Ù„ÙˆØ­Ø©" required>
                
                <label>ğŸ“¸ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØ­Ø©:</label>
                <input type="file" name="siteImg" accept="image/*" required>
                
                <input type="text" name="location" placeholder="Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (Ù…Ø«Ø§Ù„: 30.0, 31.2)" required>
                
                <label>ğŸ›¡ï¸ ØªØ­Ù…ÙŠÙ„ QR Ø±Ø®ØµØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:</label>
                <input type="file" name="adLicense" accept="image/*" required>
                
                <button type="submit" id="submitBtn" style="width:100%; background:var(--main-color); color:white; padding:15px; border:none; border-radius:8px; font-weight:bold; margin-top:10px; cursor:pointer;">
                    Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ø¯ÙˆÙ„ ğŸš€
                </button>
                <button type="button" onclick="document.getElementById('adModal').style.display='none'" style="width:100%; background:#eee; padding:10px; border:none; border-radius:8px; margin-top:10px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
            </form>
        </div>
    </div>

    <script>
        // Ø§Ù„Ù„ÙŠÙ†Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙŠ Ø£Ù†Øª Ø·Ù„Ø¹ØªÙ‡ ÙŠØ§ ØµØ­Ø¨ÙŠ
        const scriptURL = 'https://script.google.com/macros/s/AKfycbw4yrmVWAjGR3QN4pMtgpZIxERafSf_tvWx52inptmUmHiy-oI6tzCUMg6Y_j-9XU6z/exec';
        
        const form = document.getElementById('google-form');
        const submitBtn = document.getElementById('submitBtn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            submitBtn.disabled = true;
            submitBtn.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª... â³";

            // ÙˆØ¸ÙŠÙØ© ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù†Øµ (Base64)
            const toBase64 = file => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });

            try {
                const imgFile = form.querySelector('input[name="siteImg"]').files[0];
                const qrFile = form.querySelector('input[name="adLicense"]').files[0];

                const payload = {
                    siteName: form.querySelector('input[name="siteName"]').value,
                    location: form.querySelector('input[name="location"]').value,
                    adImageName: imgFile.name,
                    adImageData: await toBase64(imgFile),
                    qrCodeName: qrFile.name,
                    qrCodeData: await toBase64(qrFile)
                };

                const response = await fetch(scriptURL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.result === "success") {
                    alert('Ø§Ù„Ù„Ù‡ ÙŠÙ†ÙˆØ±! Ø§Ù„Ù„ÙˆØ­Ø© ÙˆØ§Ù„ØªØ±Ø®ÙŠØµ Ø§Ø±ÙØ¹ÙˆØ§ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                    location.reload();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                alert('Ø­ØµÙ„Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø±ÙØ¹. ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„.');
                console.error(error);
                submitBtn.disabled = false;
                submitBtn.innerHTML = "Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ø¯ÙˆÙ„ ğŸš€";
            }
        });
    </script>
</body>
</html>
